var CriticalPath=function(){var a,b,c=this,d=[],e=0,f=["jpg","jpeg","png","gif"],g=["js","css","html","json"],h=["css"],i=["html","htm"],j=!1,k=function(){var a=d[e];"img"==a.type&&m(),"script"==a.type&&n()},l=function(){e++,e>=d.length?b&&b():k()},m=function(){var a=d[e],b=a.path,c=new Image;c.src=b,c.onload=function(){if(a.clb&&a.clb(b),a.selector){if(a.src)for(var c=document.querySelectorAll(a.selector),d=0;d<c.length;++d)c[d].src=b;if(a.background)for(var c=document.querySelectorAll(a.selector),d=0;d<c.length;++d)c[d].style.backgroundImage="url("+b+")"}l()}},n=function(){var a=d[e],b=a.path,c=new XMLHttpRequest;c.open("GET",b,!0),c.onload=function(){if(c.status>=200&&c.status<400){if(a.clb&&a.clb(b,c.responseText),a.inject)if(a.css){var d=document.createElement("style");d.type="text/css",j?(d.href=b,d.rel="stylesheet"):d.textContent=c.responseText,document.head.appendChild(d)}else{var e=document.createElement("script");e.type="text/javascript",j?e.src=b:e.textContent=c.responseText,document.body.appendChild(e)}}else console.log("CriticalPath status error:",c.status);l()},c.onerror=function(){console.log("CriticalPath network error")},c.send()};return this.load=function(b){var e=b.split("."),j=e[e.length-1];return a={path:b,clb:null,selector:null},f.indexOf(j)>=0&&(a.type="img"),g.indexOf(j)>=0&&(a.type="script"),h.indexOf(j)>=0&&(a.css=!0),i.indexOf(j)>=0&&(a.doc=!0),d.push(a),c},this.then=function(b){return a.clb=b,c},this.src=function(b){var d=a;return d.selector=b,d.src=!0,c},this.background=function(b){var d=a;return d.selector=b,d.background=!0,c},this.inject=function(){var b=a;return b.inject=!0,c},this.start=function(){k()},this.end=function(a){return b=a,c},c};